<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CleanCast FaceBook</title>
  </head>
  <body style="font-family: sans-serif; text-align: center; margin-top: 40px">
    <h2>Processing Facebook Login...</h2>
    <script>
      // const params = new URLSearchParams(window.location.search);

      // const user = JSON.parse(decodeURIComponent(params.get("user")));
      // const token = params.get("token");
      // const expireIn = params.get("expireIn");

      // console.log("Facebook login successful:", { user, token, expireIn });
      // // Send data back to React (5173)

      // const payload = { user , token , expireIn };
      // if (window.opener) {
      //   window.opener.postMessage(
      //     payload,
      //     "http://localhost:5173"
      //   );
      // }

      // setTimeout(() => window.close(), 30000);
      // const params = new URLSearchParams(window.location.search);

      // const user = JSON.parse(decodeURIComponent(params.get("user")));
      // const token = params.get("token");
      // const expireIn = params.get("expireIn");

      // // IMPORTANT: Send directly to React origin
      // const reactOrigin = "http://localhost:5173";

      // window.opener.postMessage({ user, token, expireIn }, reactOrigin);
      const params = new URLSearchParams(window.location.search);
      const user = JSON.parse(decodeURIComponent(params.get("user")));
      const token = params.get("token");
      const expireIn = params.get("expireIn");

      // Prevent crash if opener is blocked
      if (window.opener && window.opener.postMessage) {
        window.opener.postMessage(
          { user, token, expireIn },
          "http://localhost:5173"
        );
      } else {
        console.error("No opener found! postMessage failed.");
      }

      setTimeout(() => window.close(), 60000);
    </script>
  </body>
</html>
